<%# This code is part of Karafka Pro, a commercial component not licensed under LGPL. %>
<%# See LICENSE for details. %>

<h2 class="h2 mb-6" id="<%= subscription_group.id %>">
  <%= consumer_group.id %> /
  <%= subscription_group.id %>
</h2>

<% if subscription_group.topics.empty? %>
  <div class="mb-6">
    <%==
      alert_info('This process does not consume any messages from any topics of this subscription group.')
    %>
  </div>
<% else %>
  <% subscription_group.topics.each do |topic| %>
    <div class="data-table-wrapper">
      <table class="data-table">
        <thead>
          <tr>
            <th colspan="6">
              <%= topic.name %>
            </th>
          </tr>
          <tr>
            <th rowspan="2"><%== sort_link('Partition', :id) %></th>
            <th rowspan="2"><%== sort_link(:poll_state) %></th>
            <th rowspan="2"><%== sort_link(:lag_hybrid) %></th>
            <th colspan="2">Offsets</th>
            <th rowspan="2">Options</th>
          </tr>
          <tr>
            <th><%== sort_link(:committed_offset) %></th>
            <th><%== sort_link(:stored_offset) %></th>
          </tr>
        </thead>
        <tbody>
            <% topic.partitions.each do |partition| %>
              <%==
                partial(
                  'consumers/partitions/offsets/partition',
                  locals: {
                    topic: topic,
                    partition: partition,
                    subscription_group: subscription_group
                  }
                )
              %>
            <% end %>
        </tbody>
      </table>
    </div>
  <% end %>
<% end %>
