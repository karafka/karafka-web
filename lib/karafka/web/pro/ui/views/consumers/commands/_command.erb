<%# This code is part of Karafka Pro, a commercial component not licensed under LGPL. %>
<%# See LICENSE for details. %>

<% if command_message.is_a?(Array) %>
  <%== partial 'shared/not_a_message' %>
<% else %>
  <% command = command_message.payload %>

  <% if command[:schema_version] == @schema_version %>
    <% row_partial = command[:type] == 'request' ? 'rows/request' : 'rows/response' %>
    <%==
      partial(
        "consumers/commands/#{row_partial}",
        locals: {
          command: command,
          command_message: command_message
        }
      )
    %>
  <% else %>
    <%== partial 'consumers/commands/incompatible_command' %>
  <% end %>
<% end %>
